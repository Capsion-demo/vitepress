# å®ç°Webç«¯è‡ªå®šä¹‰æˆªå±(JSç‰ˆ)

[![img](https://p9-passport.byteacctimg.com/img/user-avatar/732186508929940c0ea6978021bc9f76~300x300.image)](https://juejin.cn/user/3984285870859614)

[ç¥å¥‡çš„ç¨‹åºå‘˜ ![lv-5](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f8d51984638784aff27209d38b6cd3bf.svg)](https://juejin.cn/user/3984285870859614)

2021å¹´02æœˆ22æ—¥ 09:57 Â· é˜…è¯» 9397

å·²å…³æ³¨

![å®ç°Webç«¯è‡ªå®šä¹‰æˆªå±(JSç‰ˆ)](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/247cea8a3eaa43b1811ad68035065c4d~tplv-k3u1fbpfcp-zoom-crop-mark:1304:1304:1304:734.awebp)

## å‰è¨€

å‰å‡ å¤©æˆ‘å‘å¸ƒäº†ä¸€ä¸ªwebç«¯è‡ªå®šä¹‰æˆªå›¾çš„æ’ä»¶ï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰å¼€å‘è€…åé¦ˆè¿™ä¸ªæ’ä»¶æ— æ³•åœ¨vue2é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œäºæ˜¯ï¼Œæˆ‘å°±å¼€å§‹æ‰¾é—®é¢˜ï¼Œå‘ç°æˆ‘çš„æ’ä»¶æ˜¯åŸºäºVue3çš„å¼€å‘çš„ï¼Œç”±äºVue3çš„æ’ä»¶å’ŒVue2çš„æ’ä»¶å®Œå…¨ä¸å…¼å®¹ï¼Œå› æ­¤æ’ä»¶ä¹Ÿå°±åªèƒ½åœ¨Vue3é¡¹ç›®ä¸­ä½¿ç”¨ã€‚

ç»è¿‡ä¸€ç•ªè€ƒè™‘åï¼Œæˆ‘å†³å®šç”¨åŸç”Ÿjsæ¥é‡æ„è¿™ä¸ªæ’ä»¶ï¼Œè®©å…¶ä¸ä¾èµ–ä»»ä½•åº“ï¼Œè¿™æ ·å®ƒå°±èƒ½è¿è¡Œåœ¨ä»»æ„ä¸€å°æ”¯æŒjsçš„è®¾å¤‡ä¸Šï¼Œæœ¬æ–‡å°±è·Ÿå¤§å®¶åˆ†äº«ä¸‹æˆ‘é‡æ„è¿™ä¸ªæ’ä»¶çš„è¿‡ç¨‹ï¼Œæ¬¢è¿å„ä½æ„Ÿå…´è¶£çš„å¼€å‘è€…é˜…è¯»æœ¬æ–‡ã€‚

è¿è¡Œç»“æœè§†é¢‘ï¼š[å®ç°webç«¯è‡ªå®šä¹‰æˆªå±](https://link.juejin.cn/?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Ey4y127cV%2F)

## å†™åœ¨å‰é¢

æœ¬æ–‡ä¸è®²è§£æ’ä»¶çš„å…·ä½“å®ç°æ€è·¯ï¼Œå¯¹æ’ä»¶å®ç°æ€è·¯æ„Ÿå…´è¶£çš„å¼€å‘è€…è¯·ç§»æ­¥ï¼š[å®ç°Webç«¯è‡ªå®šä¹‰æˆªå±](https://juejin.cn/post/6924368956950052877)

## æ­å»ºå¼€å‘ç¯å¢ƒ

æˆ‘æƒ³ä½¿ç”¨tsã€scssã€eslintã€prettieræ¥æå‡æ’ä»¶çš„å¯ç»´æŠ¤æ€§ï¼Œåˆå«Œéº»çƒ¦ï¼Œä¸æƒ³æ‰‹åŠ¨é…ç½®webpackç¯å¢ƒï¼Œäºæ˜¯æˆ‘å†³å®šä½¿ç”¨Vue CLIæ¥æ­å»ºæ’ä»¶å¼€å‘ç¯å¢ƒã€‚

æœ¬æ–‡ä¸ç»†è®²Vue CLIæ­å»ºæ’ä»¶å¼€å‘ç¯å¢ƒçš„è¿‡ç¨‹ï¼Œå¯¹æ­¤æ„Ÿå…´è¶£çš„å¼€å‘è€…è¯·ç§»æ­¥ï¼š[ä½¿ç”¨CLIå¼€å‘ä¸€ä¸ªVue3çš„npmåº“](https://juejin.cn/post/6907428535510499336)ã€‚

### ç§»é™¤vueç›¸å…³ä¾èµ–

æˆ‘ä»¬æ­å»ºå¥½æ’ä»¶çš„å¼€å‘ç¯å¢ƒåï¼ŒCLIé»˜è®¤ä¼šåœ¨package.jsonä¸­æ·»åŠ Vueçš„ç›¸å…³åŒ…ï¼Œæˆ‘ä»¬çš„æ’ä»¶ä¸ä¼šä¾èµ–äºvueï¼Œå› æ­¤æˆ‘ä»¬æŠŠå®ƒåˆ é™¤å³å¯ã€‚

```diff
{
- "vue": "^3.0.0-0",
- "vue-class-component": "^8.0.0-0"
}

å¤åˆ¶ä»£ç 
```

### åˆ›å»ºDOM

ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨domï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨jsåŠ¨æ€æ¥åˆ›å»ºdomï¼Œæœ€åå°†å…¶æŒ‚è½½åˆ°bodyä¸­ï¼Œåœ¨vue3ç‰ˆæœ¬çš„æˆªå›¾æ’ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[vueç»„ä»¶](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fscreen-shot%2Fblob%2Fmaster%2Fsrc%2Fcomponents%2Fscreen-short.vue)æ¥è¾…åŠ©æˆ‘ä»¬ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¦åŸºäºç»„ä»¶æ¥ä½¿ç”¨jsæ¥åˆ›å»ºå¯¹åº”çš„domï¼Œä¸ºå…¶ç»‘å®šå¯¹åº”çš„äº‹ä»¶ã€‚

éƒ¨åˆ†å®ç°ä»£ç å¦‚ä¸‹ï¼Œå®Œæ•´ä»£ç è¯·ç§»æ­¥ï¼š[CreateDom.ts](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fjs-screen-shot%2Fblob%2Fmaster%2Fsrc%2Flib%2Fmain-entrance%2FCreateDom.ts)

```typescript
import toolbar from "@/lib/config/Toolbar";
import { toolbarType } from "@/lib/type/ComponentType";
import { toolClickEvent } from "@/lib/split-methods/ToolClickEvent";
import { setBrushSize } from "@/lib/common-methords/SetBrushSize";
import { selectColor } from "@/lib/common-methords/SelectColor";
import { getColor } from "@/lib/common-methords/GetColor";

export default class CreateDom {
  // æˆªå›¾åŒºåŸŸcanvaså®¹å™¨
  private readonly screenShortController: HTMLCanvasElement;
  // æˆªå›¾å·¥å…·æ å®¹å™¨
  private readonly toolController: HTMLDivElement;
  // ç»˜åˆ¶é€‰é¡¹é¡¶éƒ¨icoå®¹å™¨
  private readonly optionIcoController: HTMLDivElement;
  // ç”»ç¬”ç»˜åˆ¶é€‰é¡¹å®¹å™¨
  private readonly optionController: HTMLDivElement;
  // æ–‡å­—å·¥å…·è¾“å…¥å®¹å™¨
  private readonly textInputController: HTMLDivElement;

  // æˆªå›¾å·¥å…·æ å›¾æ ‡
  private readonly toolbar: Array<toolbarType>;
  
    constructor() {
    this.screenShortController = document.createElement("canvas");
    this.toolController = document.createElement("div");
    this.optionIcoController = document.createElement("div");
    this.optionController = document.createElement("div");
    this.textInputController = document.createElement("div");
    // ä¸ºæ‰€æœ‰domè®¾ç½®id
    this.setAllControllerId();
    // ä¸ºç”»ç¬”ç»˜åˆ¶é€‰é¡¹è§’æ ‡è®¾ç½®class
    this.setOptionIcoClassName();
    this.toolbar = toolbar;
    // æ¸²æŸ“å·¥å…·æ 
    this.setToolBarIco();
    // æ¸²æŸ“ç”»ç¬”ç›¸å…³é€‰é¡¹
    this.setBrushSelectPanel();
    // æ¸²æŸ“æ–‡æœ¬è¾“å…¥
    this.setTextInputPanel();
    // æ¸²æŸ“é¡µé¢
    this.setDomToBody();
    // éšè—æ‰€æœ‰dom
    this.hiddenAllDom();
  }
  
  /** å…¶ä»–ä»£ç çœç•¥ **/
  
}
å¤åˆ¶ä»£ç 
```

### æ’ä»¶å…¥å£æ–‡ä»¶

åœ¨å¼€å‘vueæ’ä»¶æ—¶æˆ‘ä»¬éœ€è¦æš´éœ²ä¸€ä¸ªinstallæ–¹æ³•ï¼Œç”±äºæ­¤å¤„æˆ‘ä»¬ä¸éœ€è¦ä¾èµ–vueï¼Œæˆ‘ä»¬å°±æ— éœ€æš´éœ²installæ–¹æ³•ï¼Œæˆ‘çš„é¢„æƒ³æ•ˆæœæ˜¯ï¼šç”¨æˆ·åœ¨ä½¿ç”¨æˆ‘æ’ä»¶æ—¶ï¼Œç›´æ¥å®ä¾‹åŒ–æ’ä»¶å°±èƒ½æ­£å¸¸è¿è¡Œã€‚

å› æ­¤ï¼Œæˆ‘ä»¬é»˜è®¤æš´éœ²å‡ºä¸€ä¸ªclassï¼Œæ— è®ºæ˜¯ä½¿ç”¨scriptæ ‡ç­¾å¼•å…¥æ’ä»¶ï¼Œè¿˜æ˜¯åœ¨å…¶ä»–jsæ¡†æ¶é‡Œä½¿ç”¨importæ¥å¼•å…¥æ’ä»¶ï¼Œéƒ½åªéœ€è¦åœ¨ä½¿ç”¨æ—¶newä¸€ä¸‹å³å¯ã€‚

éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼Œå®Œæ•´ä»£ç è¯·ç§»æ­¥ï¼š[main.ts](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fjs-screen-shot%2Fblob%2Fmaster%2Fsrc%2Fmain.ts)

```typescript
import CreateDom from "@/lib/main-entrance/CreateDom";
// å¯¼å…¥æˆªå›¾æ‰€éœ€æ ·å¼
import "@/assets/scss/screen-short.scss";
import InitData from "@/lib/main-entrance/InitData";
import {
  cutOutBoxBorder,
  drawCutOutBoxReturnType,
  movePositionType,
  positionInfoType,
  zoomCutOutBoxReturnType
} from "@/lib/type/ComponentType";
import { drawMasking } from "@/lib/split-methods/DrawMasking";
import { fixedData, nonNegativeData } from "@/lib/common-methords/FixedData";
import { drawPencil, initPencil } from "@/lib/split-methods/DrawPencil";
import { drawText } from "@/lib/split-methods/DrawText";
import { drawRectangle } from "@/lib/split-methods/DrawRectangle";
import { drawCircle } from "@/lib/split-methods/DrawCircle";
import { drawLineArrow } from "@/lib/split-methods/DrawLineArrow";
import { drawMosaic } from "@/lib/split-methods/DrawMosaic";
import { drawCutOutBox } from "@/lib/split-methods/DrawCutOutBox";
import { zoomCutOutBoxPosition } from "@/lib/common-methords/ZoomCutOutBoxPosition";
import { saveBorderArrInfo } from "@/lib/common-methords/SaveBorderArrInfo";
import { calculateToolLocation } from "@/lib/split-methods/CalculateToolLocation";

export default class ScreenShort {
  // å½“å‰å®ä¾‹çš„å“åº”å¼dataæ•°æ®
  private readonly data: InitData;

  // videoå®¹å™¨ç”¨äºå­˜æ”¾å±å¹•MediaStreamæµ
  private readonly videoController: HTMLVideoElement;
  // æˆªå›¾åŒºåŸŸcanvaså®¹å™¨
  private readonly screenShortController: HTMLCanvasElement | null;
  // æˆªå›¾å·¥å…·æ dom
  private readonly toolController: HTMLDivElement | null;
  // æˆªå›¾å›¾ç‰‡å­˜æ”¾å®¹å™¨
  private readonly screenShortImageController: HTMLCanvasElement;
  // æˆªå›¾åŒºåŸŸç”»å¸ƒ
  private screenShortCanvas: CanvasRenderingContext2D | undefined;
  // æ–‡æœ¬åŒºåŸŸdom
  private readonly textInputController: HTMLDivElement | null;
  //  æˆªå›¾å·¥å…·æ ç”»ç¬”é€‰é¡¹dom
  private optionController: HTMLDivElement | null;
  private optionIcoController: HTMLDivElement | null;
  // å›¾å½¢ä½ç½®å‚æ•°
  private drawGraphPosition: positionInfoType = {
    startX: 0,
    startY: 0,
    width: 0,
    height: 0
  };
  // ä¸´æ—¶å›¾å½¢ä½ç½®å‚æ•°
  private tempGraphPosition: positionInfoType = {
    startX: 0,
    startY: 0,
    width: 0,
    height: 0
  };
  // è£å‰ªæ¡†è¾¹æ¡†èŠ‚ç‚¹åæ ‡äº‹ä»¶
  private cutOutBoxBorderArr: Array<cutOutBoxBorder> = [];
  // å½“å‰æ“ä½œçš„è¾¹æ¡†èŠ‚ç‚¹
  private borderOption: number | null = null;

  // ç‚¹å‡»è£å‰ªæ¡†æ—¶çš„é¼ æ ‡åæ ‡
  private movePosition: movePositionType = {
    moveStartX: 0,
    moveStartY: 0
  };

  // é¼ æ ‡ç‚¹å‡»çŠ¶æ€
  private clickFlag = false;
  private fontSize = 17;
  // æœ€å¤§å¯æ’¤é”€æ¬¡æ•°
  private maxUndoNum = 15;
  // é©¬èµ›å…‹æ¶‚æŠ¹åŒºåŸŸå¤§å°
  private degreeOfBlur = 5;

  // æ–‡æœ¬è¾“å…¥æ¡†ä½ç½®
  private textInputPosition: { mouseX: number; mouseY: number } = {
    mouseX: 0,
    mouseY: 0
  };
  constructor() {
    // åˆ›å»ºdom
    new CreateDom();
    this.videoController = document.createElement("video");
    this.videoController.autoplay = true;
    this.screenShortImageController = document.createElement("canvas");
    // å®ä¾‹åŒ–å“åº”å¼data
    this.data = new InitData();
    // è·å–æˆªå›¾åŒºåŸŸcanvaså®¹å™¨
    this.screenShortController = this.data.getScreenShortController() as HTMLCanvasElement | null;
    this.toolController = this.data.getToolController() as HTMLDivElement | null;
    this.textInputController = this.data.getTextInputController() as HTMLDivElement | null;
    this.optionController = this.data.getOptionController() as HTMLDivElement | null;
    this.optionIcoController = this.data.getOptionIcoController() as HTMLDivElement | null;
    this.load();
  }
  
  /** å…¶ä»–ä»£ç çœç•¥ **/
}
å¤åˆ¶ä»£ç 
```

### å¯¹å¤–æš´éœ²defaultå±æ€§

åšå®Œä¸Šè¿°é…ç½®åæˆ‘ä»¬çš„æ’ä»¶å¼€å‘ç¯å¢ƒå°±æ­å»ºå¥½äº†ï¼Œæˆ‘æ‰§è¡Œbuildå‘½ä»¤æ‰“åŒ…æ’ä»¶åï¼Œåœ¨vue2é¡¹ç›®ä¸­ä½¿ç”¨importå½¢å¼æ­£å¸¸è¿è¡Œï¼Œåœ¨ä½¿ç”¨scriptæ ‡ç­¾æ—¶å¼•å…¥æ—¶å´æŠ¥é”™äº†ï¼Œäºæ˜¯æˆ‘å°†æš´éœ²å‡ºæ¥çš„`screenShotPlugin`å˜é‡æ‰“å°å‡ºæ¥åå‘ç°ä»–è¿˜æœ‰ä¸ªdefaultå±æ€§ï¼Œdefaultå±æ€§æ‰æ˜¯æˆ‘ä»¬æ’ä»¶æš´éœ²å‡ºæ¥çš„ä¸œè¥¿ã€‚

æ±‚åŠ©äº†ä¸‹æˆ‘æœ‹å‹[@_Dreams](https://juejin.cn/user/3790771823314397)æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦é…ç½®ä¸‹webpackä¸­çš„`output.libraryExport`å±æ€§ï¼Œæˆ‘ä»¬çš„æ’ä»¶æ˜¯ä½¿ç”¨Vue CLIå¼€å‘çš„ï¼Œæœ‰å…³webpackçš„é…ç½®éœ€è¦åœ¨éœ€è¦åœ¨`vue.config.js`ä¸­è¿›è¡Œé…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
module.exports = {
    // è‡ªå®šä¹‰webpacké…ç½®
  configureWebpack: {
    output: {
      // å¯¹å¤–æš´éœ²defaultå±æ€§
      libraryExport: "default"
    }
  }
}
å¤åˆ¶ä»£ç 
```

> è¿™ä¸€å—çš„é…ç½®åœ¨Vue CLIæ–‡æ¡£ä¸­ä¹Ÿæœ‰è¢«æåˆ°ï¼Œæ„Ÿå…´è¶£çš„å¼€å‘è€…è¯·ç§»æ­¥ï¼š[build-targets.html#vue-vs-js-ts-entry-files](https://link.juejin.cn/?target=https%3A%2F%2Fcli.vuejs.org%2Fguide%2Fbuild-targets.html%23vue-vs-js-ts-entry-files)

## ä½¿ç”¨webrtcæˆªå–æ•´ä¸ªå±å¹•

æ’ä»¶ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯html2canvasæ¥å°†domè½¬æ¢ä¸ºcanvasçš„ï¼Œå› ä¸ºä»–è¦éå†æ•´ä¸ªbodyä¸­çš„domï¼Œç„¶åå†è½¬æ¢æˆcanvasï¼Œè€Œä¸”å›¾ç‰‡è¿˜ä¸èƒ½è·¨åŸŸï¼Œå¦‚æœé¡µé¢ä¸­å›¾ç‰‡ä¸€å¤šï¼Œå®ƒä¼šå˜å¾—éå¸¸æ…¢ã€‚

åœ¨[ä¸Šä¸€ç¯‡æ–‡ç« ](https://juejin.cn/post/6924368956950052877)çš„è¯„è®ºåŒºä¸­æœ‰ä½å¼€å‘è€… [@åå­—ä»€ä¹ˆçš„éƒ½ä¸é‡è¦](https://juejin.cn/user/1978776662326392) å»ºè®®æˆ‘ä½¿ç”¨webrtcæ¥æ›¿ä»£html2canvasï¼Œäºæ˜¯æˆ‘å°±çœ‹äº†ä¸‹webrtcçš„ç›¸å…³æ–‡æ¡£ï¼Œæœ€ç»ˆå®ç°äº†æˆªå±åŠŸèƒ½ï¼Œå®ƒæˆªå–å‡ºæ¥çš„ä¸œè¥¿æ›´ç²¾ç¡®ã€æ€§èƒ½æ›´å¥½ï¼Œä¸å­˜åœ¨å¡é¡¿é—®é¢˜ä¹Ÿä¸å­˜åœ¨cssé—®é¢˜ï¼Œè€Œä¸”å®ƒæŠŠé€‰æ‹©æƒäº¤ç»™äº†ç”¨æˆ·ï¼Œè®©ç”¨æˆ·å†³å®šæ¥å…±äº«å±å¹•çš„é‚£ä¸€éƒ¨åˆ†å†…å®¹ã€‚

### å®ç°æ€è·¯

æ¥ä¸‹æ¥å°±è·Ÿå¤§å®¶åˆ†äº«ä¸‹æˆ‘çš„å®ç°æ€è·¯ï¼š

- ä½¿ç”¨`getDisplayMedia`æ¥æ•è·å±å¹•ï¼Œå¾—åˆ°`MediaStream`æµ
- å°†å¾—åˆ°çš„`MediaStream`æµè¾“å‡ºåˆ°videoæ ‡ç­¾ä¸­
- ä½¿ç”¨canvaså°†videoæ ‡ç­¾ä¸­çš„å†…å®¹ç»˜åˆ¶åˆ°canvaså®¹å™¨ä¸­

> æœ‰å…³getDisplayMediaçš„å…·ä½“ç”¨æ³•ï¼Œè¯·ç§»æ­¥ï¼š[ä½¿ç”¨å±å¹•æ•è·API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FScreen_Capture_API%2F%E4%BD%BF%E7%94%A8%E5%B1%8F%E5%B9%95%E6%8D%95%E8%8E%B7API)

### å®ç°ä»£ç 

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…·ä½“çš„å®ç°ä»£ç ï¼Œå®Œæ•´ä»£ç è¯·ç§»æ­¥ï¼š[main.ts](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fjs-screen-shot%2Fblob%2Fmaster%2Fsrc%2Fmain.ts)

```typescript
  // åŠ è½½æˆªå›¾ç»„ä»¶
  private load() {
    // è®¾ç½®æˆªå›¾åŒºåŸŸcanvaså®½é«˜
    this.data.setScreenShortInfo(window.innerWidth, window.innerHeight);
    // è®¾ç½®æˆªå›¾å›¾ç‰‡å­˜æ”¾å®¹å™¨å®½é«˜
    this.screenShortImageController.width = window.innerWidth;
    this.screenShortImageController.height = window.innerHeight;
    // æ˜¾ç¤ºæˆªå›¾åŒºåŸŸå®¹å™¨
    this.data.showScreenShortPanel();
    // æˆªå–æ•´ä¸ªå±å¹•
    this.screenShot();
  }

  // å¼€å§‹æ•æ‰å±å¹•
  private startCapture = async () => {
    let captureStream = null;

    try {
      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore
      // @ts-ignore
      // æ•è·å±å¹•
      captureStream = await navigator.mediaDevices.getDisplayMedia();
      // å°†MediaStreamè¾“å‡ºè‡³videoæ ‡ç­¾
      this.videoController.srcObject = captureStream;
    } catch (err) {
      throw "æµè§ˆå™¨ä¸æ”¯æŒwebrtc" + err;
    }
    return captureStream;
  };

  // åœæ­¢æ•æ‰å±å¹•
  private stopCapture = () => {
    const srcObject = this.videoController.srcObject;
    if (srcObject && "getTracks" in srcObject) {
      const tracks = srcObject.getTracks();
      tracks.forEach(track => track.stop());
      this.videoController.srcObject = null;
    }
  };

  // æˆªå±
  private screenShot = () => {
    // å¼€å§‹æ•æ‰å±å¹•
    this.startCapture().then(() => {
      setTimeout(() => {
        // è·å–æˆªå›¾åŒºåŸŸcanvaså®¹å™¨ç”»å¸ƒ
        const context = this.screenShortController?.getContext("2d");
        if (context == null || this.screenShortController == null) return;

        // èµ‹å€¼æˆªå›¾åŒºåŸŸcanvasç”»å¸ƒ
        this.screenShortCanvas = context;
        // ç»˜åˆ¶è’™å±‚
        drawMasking(context);
        // å°†è·å–åˆ°çš„å±å¹•æˆªå›¾ç»˜åˆ¶åˆ°å›¾ç‰‡å®¹å™¨é‡Œ
        this.screenShortImageController
          .getContext("2d")
          ?.drawImage(
            this.videoController,
            0,
            0,
            this.screenShortImageController?.width,
            this.screenShortImageController?.height
          );
        // æ·»åŠ ç›‘å¬
        this.screenShortController?.addEventListener(
          "mousedown",
          this.mouseDownEvent
        );
        this.screenShortController?.addEventListener(
          "mousemove",
          this.mouseMoveEvent
        );
        this.screenShortController?.addEventListener(
          "mouseup",
          this.mouseUpEvent
        );
        // åœæ­¢æ•æ‰å±å¹•
        this.stopCapture();
      }, 300);
    });
  };
å¤åˆ¶ä»£ç 
```

## æ’ä»¶åœ°å€

è‡³æ­¤ï¼Œæ’ä»¶çš„å®ç°è¿‡ç¨‹å°±åˆ†äº«å®Œæ¯•äº†ã€‚

- æ’ä»¶åœ¨çº¿ä½“éªŒåœ°å€ï¼š[chat-system](https://link.juejin.cn/?target=https%3A%2F%2Fwww.kaisir.cn%2Fchat-system%2Findex.html)
- æ’ä»¶GitHubä»“åº“åœ°å€ï¼š[screen-shot](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fjs-screen-shot)
- å¼€æºé¡¹ç›®åœ°å€ï¼š[chat-system-github](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flikaia%2Fchat-system)

## å†™åœ¨æœ€å

- æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« å¸®åˆ°äº†ä½ ï¼Œæ¬¢è¿ç‚¹èµå’Œå…³æ³¨ğŸ˜Š
- æœ¬æ–‡é¦–å‘äºæ˜é‡‘ï¼Œæœªç»è®¸å¯ç¦æ­¢è½¬è½½ğŸ’Œ